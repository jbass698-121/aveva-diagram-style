<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>AVEVA Architecture Renderer ‚Äì Working Demo</title>

  <style>
    body {
      font: 14px/1.4 system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      background: #f8fafc;
    }
    
    header {
      background: linear-gradient(135deg, #0e1220 0%, #1a2332 100%);
      color: #fff;
      padding: 16px 24px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .header-title {
      font-size: 20px;
      margin: 0;
    }
    
    .header-subtitle {
      font-size: 14px;
      opacity: 0.8;
      margin: 4px 0 0 0;
    }
    
    #controls {
      padding: 24px;
      background: #ffffff;
      border-bottom: 1px solid #e2e8f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
    }
    
    textarea {
      width: 100%;
      height: 140px;
      font: 13px/1.4 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      resize: vertical;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 12px;
      background: #f8fafc;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }
    
    textarea:focus {
      outline: none;
      border-color: #3b82f6;
      background: #ffffff;
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 10px 20px;
      font-weight: 600;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      border-color: #1d4ed8;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #1d4ed8 0%, #1e3a8a 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .btn-download {
      background: #f8fafc;
      color: #374151;
      border-color: #d1d5db;
    }
    
    .btn-download:hover:not(:disabled) {
      background: #f3f4f6;
      border-color: #9ca3af;
      transform: translateY(-1px);
    }
    
    .btn-download:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    #svg-container {
      overflow: auto;
      padding: 24px;
      background: #ffffff;
      margin: 0;
    }
    
    #svg-container svg {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: #ffffff;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      max-width: 100%;
      height: auto;
    }
    
    .example-text {
      font-size: 12px;
      color: #6b7280;
      font-style: italic;
      margin-bottom: 8px;
    }
    
    .download-section {
      background: #f8fafc;
      padding: 16px 24px;
      border-top: 1px solid #e2e8f0;
    }
    
    .download-title {
      font-weight: 600;
      margin-bottom: 12px;
      color: #374151;
    }

    .error-message {
      background: #fee2e2;
      color: #991b1b;
      padding: 12px;
      border-radius: 6px;
      margin-top: 12px;
      display: none;
    }
  </style>
</head>

<body>
  <header>
    <h1 class="header-title">AVEVA Architecture Renderer</h1>
    <p class="header-subtitle">Professional architecture diagram generator</p>
  </header>

  <div id="controls">
    <label for="user-input">Architecture Description:</label>
    <div class="example-text">
      Describe your architecture in plain English
    </div>
    <textarea id="user-input" placeholder="Example: We have analytics clients and RDS clients for future expansion...">We have analytics clients and RDS clients for future expansion. There's a historian in the perimeter network. Engineering clients connect through a secured process LAN. The supervisory network has IO servers for primary and secondary operations. Device communication includes safety systems, LOFS, CGSS, RPOP, and LHFS components.</textarea>
    
    <div class="button-group">
      <button id="render-btn" class="btn-primary">üé® Generate Architecture Diagram</button>
    </div>
    
    <div id="error-message" class="error-message"></div>
  </div>

  <div class="download-section">
    <div class="download-title">üì• Export Options</div>
    <div class="button-group">
      <button id="download-svg" class="btn-download" disabled>
        üìÑ Download SVG
      </button>
      <button id="download-png" class="btn-download" disabled>
        üñºÔ∏è Download PNG
      </button>
      <button id="download-jpg" class="btn-download" disabled>
        üì∏ Download JPG
      </button>
    </div>
  </div>

  <div id="svg-container">
    <div style="text-align: center; padding: 60px; color: #9ca3af;">
      <div style="font-size: 24px; margin-bottom: 8px;">üèóÔ∏è</div>
      <div>Your architecture diagram will appear here</div>
      <div style="font-size: 12px; margin-top: 8px;">Click "Generate Architecture Diagram" to start</div>
    </div>
  </div>

  <script type="module">
    // Import from the correct files
    import { renderAvevaArch, downloadSvg, downloadPng, downloadJpg } from './aveva-renderer-1.js';
    import { convertNaturalLanguageToJSON } from './nlp-to-json.js';

    let currentSvgString = null;

    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }

    function handleUserInput(raw) {
      try {
        console.log('Processing input:', raw);
        
        const jsonData = convertNaturalLanguageToJSON(raw.trim());
        console.log('Generated JSON:', jsonData);
        
        const svgString = renderAvevaArch(jsonData, {
          width: 1400,
          height: 1000
        });
        
        console.log('Generated SVG length:', svgString.length);
        
        document.getElementById('svg-container').innerHTML = svgString;
        currentSvgString = svgString;
        
        // Enable download buttons
        document.getElementById('download-svg').disabled = false;
        document.getElementById('download-png').disabled = false;
        document.getElementById('download-jpg').disabled = false;
        
      } catch (error) {
        console.error('Rendering failed:', error);
        showError(`Rendering failed: ${error.message}`);
      }
    }

    // Event listeners
    document.getElementById('render-btn').addEventListener('click', () => {
      console.log('Render button clicked');
      const text = document.getElementById('user-input').value;
      handleUserInput(text);
    });

    document.getElementById('download-svg').addEventListener('click', () => {
      if (currentSvgString) {
        downloadSvg(currentSvgString, 'architecture-diagram.svg');
      }
    });

    document.getElementById('download-png').addEventListener('click', async () => {
      if (currentSvgString) {
        try {
          await downloadPng(currentSvgString, 'architecture-diagram.png', {
            scale: 2,
            background: '#ffffff'
          });
        } catch (error) {
          showError(`PNG download failed: ${error.message}`);
        }
      }
    });

    document.getElementById('download-jpg').addEventListener('click', async () => {
      if (currentSvgString) {
        try {
          await downloadJpg(currentSvgString, 'architecture-diagram.jpg', {
            scale: 2,
            quality: 0.95,
            background: '#ffffff'
          });
        } catch (error) {
          showError(`JPG download failed: ${error.message}`);
        }
      }
    });

    // Auto-render on page load
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Page loaded, attempting initial render');
      const initialText = document.getElementById('user-input').value;
      if (initialText.trim()) {
        handleUserInput(initialText);
      }
    });
  </script>
</body>
</html>
